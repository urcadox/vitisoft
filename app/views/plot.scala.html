@import models.entities.Plot
@(plot: Plot)(implicit request: Request[AnyContent])

@main("Parcelle : " + plot.name, views.Section.Plots) {
  <h2>@plot.name</h2>
  <div class="row">
     <div class="plot-image col-md-6" style="background-image: url(@plot.pictureUrl.getOrElse(routes.Assets.versioned("img/default-picture.png")))"></div>
    <div class="map col-md-6"></div>
  </div>
  <h3>Audits</h3>
  @for(a <- plot.audits) {
    <div class="plot-audit">
      <h4>Le @a.date.format(java.time.format.DateTimeFormatter.ofPattern("dd/MM/yyyy"))</h4>
      <p>
        @a.measurements.length mesures
      </p>
    </div>
  }
  <script>
    function initMap() {
      // Create a map object and specify the DOM element for display.
      var map = new google.maps.Map(document.getElementsByClassName('map')[0], {});
      var coordsRaw = @plot.position.toString;
      var coords = coordsRaw.map(function(x) {
        return {
          lng: x[0],
          lat: x[1]
        };
      });
      var polygon = new google.maps.Polygon({
        paths: coords,
        strokeColor: '#00FF00',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#00AA00',
        fillOpacity: 0.2
      });
      polygon.setMap(map);
      var bounds = new google.maps.LatLngBounds();
      polygon.getPaths().forEach(function(path) {
        path.getArray().forEach(function(latlng) {
          bounds.extend(latlng);
        });
      });
      map.fitBounds(bounds);
    }

  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEYjdgW677brMTOWijhn6mVcq0r5taU8g&callback=initMap"
  async defer></script>
}
